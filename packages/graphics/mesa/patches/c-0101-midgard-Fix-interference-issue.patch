From c3dd5d3764805567de4d1b8c30aa3c1ba59f9ee2 Mon Sep 17 00:00:00 2001
From: Alyssa Rosenzweig <alyssa@rosenzweig.io>
Date: Sat, 10 Nov 2018 20:56:50 -0800
Subject: [PATCH 101/151] midgard: Fix interference issue

---
 src/gallium/drivers/panfrost/midgard/midgard_compile.c | 10 ++--------
 1 file changed, 2 insertions(+), 8 deletions(-)

diff --git a/src/gallium/drivers/panfrost/midgard/midgard_compile.c b/src/gallium/drivers/panfrost/midgard/midgard_compile.c
index fc9d81f..d454e87 100644
--- a/src/gallium/drivers/panfrost/midgard/midgard_compile.c
+++ b/src/gallium/drivers/panfrost/midgard/midgard_compile.c
@@ -1637,6 +1637,8 @@ allocate_registers(compiler_context *ctx)
 
                 if (live_end[i] == -1)
                         live_end[i] = d;
+
+                printf("%i: %d, %d\n", i, live_start[i], live_end[i]);
         }
 
         /* Setup interference between nodes that are live at the same time */
@@ -1644,14 +1646,6 @@ allocate_registers(compiler_context *ctx)
         for (int i = 0; i < nodes; ++i) {
                 for (int j = i + 1; j < nodes; ++j) {
                         if (!(live_start[i] >= live_end[j] || live_start[j] >= live_end[i]))
-                                if ((live_start[i] != -1) && (live_start[j] != -1))
-                                        ra_add_node_interference(g, i, j);
-                }
-        }
-
-        for (int i = 0; i < nodes; ++i) {
-                for (int j = i + 1; j < nodes; ++j) {
-                        if (i == 0)
                                 ra_add_node_interference(g, i, j);
                 }
         }
-- 
2.7.4

