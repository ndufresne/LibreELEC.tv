From 5a9ce3aaeef6e086a25045de5676038f189a0360 Mon Sep 17 00:00:00 2001
From: Alyssa Rosenzweig <alyssa@rosenzweig.io>
Date: Tue, 6 Nov 2018 17:15:34 -0800
Subject: [PATCH 077/151] Perhaps improve performance?

---
 src/gallium/drivers/panfrost/pan_context.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/gallium/drivers/panfrost/pan_context.c b/src/gallium/drivers/panfrost/pan_context.c
index 308709d..b3e8e16 100644
--- a/src/gallium/drivers/panfrost/pan_context.c
+++ b/src/gallium/drivers/panfrost/pan_context.c
@@ -1322,7 +1322,7 @@ panfrost_submit_frame(struct panfrost_context *ctx, bool flush_immediate)
 	bool has_draws = ctx->draw_count > 0;
 
 	/* Workaround a bizarre lockup (a hardware errata?) */
-	//if (!has_draws)
+	if (!has_draws)
 		flush_immediate = true;
 
 	/* A number of jobs are batched -- this must be linked and cleared */
@@ -1343,7 +1343,7 @@ panfrost_submit_frame(struct panfrost_context *ctx, bool flush_immediate)
 		{
 			.jc = ctx->set_value_job,
 			.atom_number = vt_atom,
-			.core_req = MALI_JD_REQ_CS | MALI_JD_REQ_T | MALI_JD_REQ_CF | MALI_JD_REQ_COHERENT_GROUP | MALI_JD_REQ_EVENT_NEVER,
+			.core_req = MALI_JD_REQ_CS | MALI_JD_REQ_T | MALI_JD_REQ_CF | MALI_JD_REQ_COHERENT_GROUP | MALI_JD_REQ_EVENT_NEVER | MALI_JD_REQ_SKIP_CACHE_END,
 		},
 		{
 			.jc = panfrost_fragment_job(ctx),
-- 
2.7.4

