From 92203a265f578cf3375fbd84db21ddef80286f73 Mon Sep 17 00:00:00 2001
From: Alyssa Rosenzweig <alyssa@rosenzweig.io>
Date: Sun, 11 Nov 2018 12:17:56 -0800
Subject: [PATCH 111/151] midgard: Allow lut multiplies

---
 src/gallium/drivers/panfrost/midgard/midgard_compile.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/gallium/drivers/panfrost/midgard/midgard_compile.c b/src/gallium/drivers/panfrost/midgard/midgard_compile.c
index 7090931..2a8e3a6 100644
--- a/src/gallium/drivers/panfrost/midgard/midgard_compile.c
+++ b/src/gallium/drivers/panfrost/midgard/midgard_compile.c
@@ -1961,14 +1961,14 @@ schedule_bundle(compiler_context *ctx, midgard_block *block, midgard_instruction
                                                 else
                                                         break;
                                         } else {
-                                                if (units & UNIT_VMUL)
+                                                if ((units & UNIT_VMUL) && !(control & UNIT_VMUL))
                                                         unit = UNIT_VMUL;
                                                 else if (units & UNIT_VADD)
                                                         unit = UNIT_VADD;
                                                 else if (units & UNIT_VLUT)
                                                         unit = UNIT_VLUT;
                                                 else
-                                                        assert(0);
+                                                        break;
                                         }
                                 } else {
                                         if (last_unit >= UNIT_VADD) {
-- 
2.7.4

